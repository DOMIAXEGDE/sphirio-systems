Got it 👍 — let’s make you a **clear developer’s manual** so you (or anyone else) can spin this environment up and down without friction. I’ll write it as if it’s part of your repo documentation.

---

# 🌐 Dev Environment Manual (PHP + HTTPS via Caddy)

This manual explains how to **run, stop, and troubleshoot** the local dev environment for your project at
`D:\domalecs-os\clix5\OSbench`.

---

## 1. 📦 Prerequisites

Before you start:

* **PHP** installed and in your PATH
  Test:

  ```powershell
  php -v
  ```
* **Caddy** installed (via Chocolatey or manually)
  Test:

  ```powershell
  caddy version
  ```
* **PowerShell** (run as Administrator when first editing `hosts`).

---

## 2. 🚀 Start the Environment

From PowerShell:

```powershell
Set-Location D:\domalecs-os\clix5\OSbench
.\run-https-dev.ps1 -Start -Open -SiteHost dev.local -PhpPort 8000
```

* **PHP** will start on: `http://127.0.0.1:8000`
* **Caddy** will start on: `https://dev.local/`
* Logs are written to: `https-dev-logs\`

👉 First run as **Administrator** to allow `dev.local` → `127.0.0.1` mapping and to trust Caddy’s local TLS cert.

---

## 3. 🧪 Check the Setup

* Visit:

  * **Diagnostics:** [https://dev.local/diagnostics.php](https://dev.local/diagnostics.php)
    Should show `APP_IS_HTTPS=true`.
  * **Your app:** [https://dev.local/](https://dev.local/)

* Inspect logs if something fails:

  ```powershell
  Get-Content .\https-dev-logs\php.err.txt -Tail 50
  Get-Content .\https-dev-logs\caddy.err.txt -Tail 50
  ```

---

## 4. 🛑 Stop the Environment

If started via script (background processes):

```powershell
.\run-https-dev.ps1 -Stop
```

This kills both **PHP** and **Caddy** using PID files.

If you manually ran `caddy run ...` in the foreground, stop it with:

```
Ctrl + C
```

---

## 5. 🔧 Common Issues

### "Caddy failed to start"

* Check if port **443** is already in use:

  ```powershell
  netstat -ano | findstr ":443" | findstr LISTENING
  ```
* If occupied, change port in `Caddyfile` to `8443`:

  ```
  dev.local:8443 {
      ...
  }
  ```

  Then access [https://dev.local:8443/](https://dev.local:8443/).

---

### "Not secure" browser warning

* Ensure the cert from Caddy is trusted (Caddy usually installs automatically).
* Clear browser HSTS cache if it persists.

---

### Changing site host

* By default, `dev.local` is mapped.
* You can start with `localhost` instead:

  ```powershell
  .\run-https-dev.ps1 -Start -SiteHost localhost -PhpPort 8000
  ```

---

## 6. 🗂 Directory Structure (dev-related)

```
OSbench/
│
├─ run-https-dev.ps1       # Script to start/stop environment
├─ Caddyfile               # Auto-generated by script
├─ https-dev-logs/         # PHP & Caddy logs
├─ diagnostics.php         # Simple health check
└─ (your PHP app files...)
```

---

## 7. 📝 Workflow Summary

1. `.\run-https-dev.ps1 -Start -Open`
   → Start PHP + Caddy with HTTPS.
2. Work on code, refresh [https://dev.local/](https://dev.local/).
3. Debug issues via logs.
4. `.\run-https-dev.ps1 -Stop` when done.

---

✅ With this workflow, you get:

* HTTPS locally (with trusted certs)
* Clean separation of PHP (port 8000) and Caddy (port 443)
* Simple start/stop commands for repeatable dev sessions

---

Would you like me to also prepare this manual as a **`DEV-SETUP.md`** file, ready to drop into your repo?
